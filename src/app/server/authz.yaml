# Authorization rule declations
# Top-level categories are not used: they are all merged into one flat
# dictionary.


# Roles

 - name: admin
   description: "the administrator role"
   failure: "you are not an administrator"
   expression: 's.has_role("admin")'

 - name: author
   description: "the author role"
   failure: "you are not an author"
   expression: 's.has_role("author")'

 - name: authority
   description: "authority role"
   failure: "you are not an authority"
   expression: 's.has_role("authority")'

 - name: clerk
   description: "the clerk role"
   failure: "you are not a clerk"
   expression: 's.has_role("clerk")'

 - name: consultant
   description: "the consultant role"
   failure: "you are not a consultant"
   expression: 's.has_role("consultant")'

 - name: org_admin
   description: "the organisation admin role"
   failure: "you are not an organisation administrator"
   expression: 's.has_role("org_admin")'


# Admin

 - name: conf_view
   description: "permission to view system config"
   failure: "you can't view system config"
   expression: '@admin'

 - name: conf_edit
   description: "permission to edit system config"
   failure: "you can't edit system config"
   expression: '@admin'

 - name: conf_del
   description: "permission to edit system config"
   failure: "you can't edit system config"
   expression: '@admin'


# User

 - name: _own_user
   description: "you are the owner"
   failure: "you are not the owner"
   expression: 'user.id == s.user.id'

 - name: user_add
   description: "permission to add a new user"
   failure: "you can't add a new user"
   expression: '@admin or (@org_admin and @_own_org)'

 - name: user_change_org
   description: "permission to change a user's organisation"
   failure: "you can't change a user's organisation"
   expression: '@admin'

 - name: user_del
   description: "permission to delete a user"
   failure: "you can't delete a user"
   expression: '@user_add and not @_own_user'

 - name: user_edit
   description: "permission to modify a user"
   failure: "you can't modify a user"
   expression: '@user_add or @_own_user'

 - name: user_enable
   description: "permission to enable a user's account"
   failure: "you can't enable a user"
   expression: '@user_add'

 - name: user_impersonate
   description: "permission to impersonate another user"
   failure: "you can't impersonate a user"
   expression: '@user_add and not @_own_user and s.superuser'


# Organisation

 - name: _own_org
   description: "you are a member of the organisation"
   failure: "you are not a member of the organisation"
   expression: 'org.id == s.org.id'

 - name: org_browse
   description: "permission to browse organisations organisation"
   failure: "you can't browse organisations"
   expression: 'True'

 - name: org_view
   description: "permission to view an organisation"
   failure: "you can't view an organisation"
   expression: 'True'

 - name: org_add
   description: "permission to add a new organisation"
   failure: "you can't add a new organisation"
   expression: '@admin'

 - name: org_del
   description: "permission to delete an organisation"
   failure: "you can't delete an organisation"
   expression: '@org_add and not @_own_org'

 - name: org_edit
   description: "permission to edit an organisation"
   failure: "you can't modify an organisation"
   expression: '@org_add or (@org_admin and @_own_org)'


# Post

 - name: _own_post
   description: "the post belongs to your organisation"
   failure: "the post doesn't belong to your oganisation"
   expression: 'post.org_id == s.org.id'

 - name: post_new
   description: "permission to broadcast a message"
   failure: "you can't broadcast a message"
   expression: '@org_admin'

 - name: post_to_all
   description: "permission to broadcast a message to everyone"
   failure: "you can't broadcast a message to everyone"
   expression: '@admin'

 - name: post_edit
   description: "permission to edit a post"
   failure: "you can't modify a post"
   expression: '@admin or (@org_admin and @_own_post)'

 - name: post_edit_try
   description: "permission to attempt to edit a post"
   failure: "you can't attempt to modify a post"
   expression: '@org_admin'


# Survey

 - name: measure_add
   description: "permission to add a new measure"
   failure: "you can't add a new measure"
   expression: '@program_edit'

 - name: measure_del
   description: "permission to delete a measure"
   failure: "you can't delete a measure"
   expression: '@program_edit'

 - name: measure_edit
   description: "permission to edit a measure"
   failure: "you can't modify a measure"
   expression: '@program_edit'

 - name: program_add
   description: "permission to add a new program"
   failure: "you can't add a new program"
   expression: '@author'

 - name: program_del
   description: "permission to delete a program"
   failure: "you can't delete a program"
   expression: '@program_add'

 - name: program_dup
   description: "permission to duplicate a program"
   failure: "you can't duplicate a program"
   expression: '@admin'

 - name: program_edit
   description: "permission to edit a program"
   failure: "you can't edit a program"
   expression: '@program_add'

 - name: program_node_edit
   description: "permission to edit a program node"
   failure: "you can't edit a program node"
   expression: '@program_edit'

 - name: program_state
   description: "permission to change a program's state"
   failure: "you can't change a program's state"
   expression: '@admin'

 - name: qnode_add
   description: "permission to add a new category"
   failure: "you can't add a new category"
   expression: '@program_edit'

 - name: qnode_del
   description: "permission to delete a category"
   failure: "you can't delete a category"
   expression: '@program_edit'

 - name: qnode_edit
   description: "permission to edit a category"
   failure: "you can't edit a category"
   expression: '@program_edit'

 - name: response_type_add
   description: "permission to add a new response type"
   failure: "you can't add a new response type"
   expression: '@program_edit'

 - name: response_type_del
   description: "permission to delete a response type"
   failure: "you can't delete a response type"
   expression: '@program_edit'

 - name: response_type_edit
   description: "permission to edit a response type"
   failure: "you can't edit a response type"
   expression: '@program_edit'

 - name: survey_add
   description: "permission to create a survey"
   failure: "you can't create a survey"
   expression: '@program_edit'

 - name: survey_del
   description: "permission to delete a survey"
   failure: "you can't delete a survey"
   expression: '@program_edit'

 - name: survey_edit
   description: "permission to edit a survey"
   failure: "you can't edit a survey"
   expression: '@program_edit'

 - name: survey_purchase
   description: "permission to give access to a survey"
   failure: "you can't give access to a survey"
   expression: '@admin'


# Submission

 - name: response_edit
   description: "permission to edit a response"
   failure: "you can't edit a response"
   expression: '@submission_edit'

 - name: response_view
   description: "permission to view a response"
   failure: "you can't view a response"
   expression: '@response_edit'

 - name: submission_add
   description: "permission to create a submission"
   failure: "you can't create a submission"
   expression: '@consultant or (@clerk and @_own_org)'

 - name: submission_browse
   description: "permission to browse submissions"
   failure: "you can't browse submissions"
   expression: '@submission_browse_any or (@clerk and @_own_org)'

 - name: submission_browse_any
   description: "permission to browse all submissions"
   failure: "you can't browse all submissions"
   expression: '@consultant'

 - name: submission_del
   description: "permission to delete a submission"
   failure: "you can't delete a submission"
   expression: '@submission_edit'

 - name: submission_edit
   description: "permission to edit a submission"
   failure: "you can't edit a submission"
   expression: '@consultant or (@org_admin and @_own_org)'

 - name: submission_view_aggregate_score
   description: "permission to view aggregate scores"
   failure: "you can't view aggregate scores"
   expression: '@submission_view_single_score'

 - name: submission_view_single_score
   description: "permission to view a single score"
   failure: "you can't view a single score"
   expression: '@consultant or (@org_admin and @_own_org)'


# Report

 - name: custom_query
   description: "permission to run a custom report"
   failure: "you can't run a custom report"
   expression: '@admin'

 - name: report_chart
   description: "permission to view a chart"
   failure: "you can't view a chart"
   expression: '@consultant'

 - name: report_temporal
   description: "permission to view a temporal report"
   failure: "you can't view a temporal report"
   expression: '@report_temporal_full'

 - name: report_temporal_full
   description: "permission to view a temporal report"
   failure: "you can't view a temporal report"
   expression: '@consultant'
