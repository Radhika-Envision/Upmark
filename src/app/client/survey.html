<div class="header"
    ng-class="{'deleted': survey.deleted}">
<div class="container">
    <div class="toolbar">
        <button class="btn btn-default btn-round" title="Print"
                ng-if="!edit.model"
                onclick="print()">
            <i class="fa fa-print"></i>
        </button>
        <a class="btn btn-default btn-round" title="Duplicate"
                ng-href="#/survey/new?duplicate={{survey.id}}"
                ng-if="!edit.model && checkRole('survey_dup')">
            <small><i class="fa fa-clone"></i></small></button></a>
        <delete-button model="survey" editor="edit"
            ng-if="survey.isEditable && !edit.model &&
                checkRole('survey_del')"></delete-button>
        <button class="btn btn-default btn-round" title="Cancel"
                ng-click="edit.cancel()"
                ng-if="edit.model && edit.model.id && !rtEdit.rt">
            <i class="fa fa-times"></i></button>
        <button class="btn btn-default btn-round" title="Save"
                ng-click="edit.save()"
                ng-if="edit.model && !rtEdit.rt"
                form="editor"
                form-save-button="editor">
            <i class="fa fa-check"></i></button>
        <button class="btn btn-default btn-round" title="Edit"
                ng-click="edit.edit()"
                ng-if="survey.isEditable && !edit.model &&
                    checkRole('survey_edit')">
            <i class="fa fa-pencil"></i></button>
        <a class="btn btn-default btn-round" title="Subscriptions"
                ng-href="#/subscription/program?id={{survey.id}}">
            <i class="fa fa-envelope"></i></a>
        <survey-history entity="survey" service="Survey"
                ng-if="!edit.model"></survey-history>
    </div>
    <question-header entity="survey" type="survey"></question-header>
</div>
</div>

<div ng-if="edit.model" class="container">
    <form novalidate name="form" id="editor" form-nav-warn>
        <div class="form-group" show-errors>
            <label for="title">Name</label>
            <span class="help-label" ng-if="form.title.$error.required">
                Please provide a title.</span>
            <input type="text" class="form-control" id="title" name="title"
                ng-model="edit.model.title" required />
        </div>
        <div class="form-group">
            <label for="description">Description</label>
            <markdown-editor id="description"
                ng-model="edit.model.description"
                title="Description"></markdown-editor>
        </div>
        <div class="checkbox">
            <label>
                <input type="checkbox" id="inclQuality" name="inclQuality"
                    ng-model="edit.model.hasQuality">
                    Include response quality
            </label>
        </div>
        <div class="checkbox">
            <label>
                <input type="checkbox" id="hideAggregate" name="hideAggregate"
                    ng-model="edit.model.hideAggregate">
                    Disable aggregate category scores
            </label>
        </div>

    </form>

    <div ng-include="'response_types.html'"
            ng-controller="ResponseTypeEditorCtrl"></div>

    <docs ng-if="!edit.model.id && duplicating">
        <i class="fa-li fa fa-clone fa-border"></i>
        <p>
            You are creating a duplicate of an existing program. The full
            structure of the program will be copied, with the lineage to the old
            program preserved. Submissions will not be copied, but they can
            be at a later time.
        </p>
        <p>
            If you want to create a fresh program with no lineage,
            <a href="#/surveys">go back</a> and use the Add
            <i class="fa fa-plus"></i> function instead.
        </p>
    </docs>
    <docs ng-if="!edit.model.id && !duplicating">
        <i class="fa-li fa fa-plus fa-border"></i>
        <p>
            You are creating a new program with a new structure. It will not
            be possible to link responses from other programs to this one.
        </p>
        <p>
            If you wish to preserve lineage, <a href="#/surveys">open an
            existing program</a> and use the Duplicate
            <i class="fa fa-clone"></i> function instead.
        </p>
    </docs>
</div>


<div ng-if="!edit.model">

<div class="container" ng-if="survey.description">
    <div ng-bind-html="survey.description | markdown"></div>
</div>

<div class="container hidden-print" ng-if="checkRole('survey_edit')">
    <p>
        <span ng-if="survey.isEditable">
            This program is editable.
        </span>
        <span ng-if="!survey.isEditable">
            This program is not editable.
        </span>
    </p>
</div>


<div class="container hidden-print" ng-if="checkRole('survey_state')">
    <p class="text-center">
        <!-- Admin buttons -->
        <button class="btn btn-link" ng-click="toggleEditable()">
            <i class="fa fa-pencil-square-o">
                <i ng-if="survey.isEditable"
                    class="fa fa-ban fa-badge fa-badge-left"></i>
            </i>
            <span ng-if="survey.isEditable">
                Make non-editable</span>
            <span ng-if="!survey.isEditable">
                Make editable</span>
        </button>
    </p>
</div>


<div class="container">
    <div class="section">
        <div class="toolbar">
            <a class="btn btn-default btn-round" title="Search for measures"
                    ng-href="#/measures?survey={{survey.id}}">
                <i class="fa fa-fw fa-search"></i></a>
            <a class="btn btn-default btn-round" title="Add new"
                    ng-href="#/hierarchy/new?survey={{survey.id}}"
                    ng-if="survey.isEditable && checkRole('hierarchy_add')">
                <i class="fa fa-fw fa-plus"></i></a>
            <delete-cycle class="btn-round" model="search.deleted"></delete-cycle>
        </div>
        <h2 label="Sv">
            Surveys
        </h2>
    </div>

    <ul class="list-results">
        <li ng-repeat="hierarchy in hierarchies"
                ng-class="{strike: hierarchy.deleted}">
            <a ng-href="#/hierarchy/{{hierarchy.id}}/choice?survey={{survey.id}}">
                <h4>{{hierarchy.title}}</h4>
                <p class="truncate">{{hierarchy.nMeasures}} measures</p>
            </a>
        </li>
    </ul>

    <p ng-if="!hierarchies.length">
        There are no <span ng-if="search.deleted">deleted</span> surveys.
    </p>
</div>


<docs ng-if="survey.deleted">
    <i class="fa-li fa fa-trash fa-border"></i>
    <h3>Deleted</h3>
    <p>
        This program has been deleted.
    </p>
</docs>

</div><!-- !edit.model -->
