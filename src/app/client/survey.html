<div class="header">
<div class="container">
    <div class="toolbar">
        <a class="btn btn-default btn-round" title="Duplicate"
                ng-href="#/survey/new?duplicate={{survey.id}}"
                ng-if="!edit.model && checkRole('survey_dup')">
            <small><i class="fa fa-clone"></i></small></button></a>
        <button class="btn btn-default btn-round" title="Delete"
                ng-click="edit.del()"
                ng-if="survey.isEditable && !edit.model &&
                    checkRole('survey_del')">
            <i class="fa fa-trash-o"></i></button>
        <button class="btn btn-default btn-round" title="Cancel"
                ng-click="edit.cancel()"
                ng-if="edit.model && edit.model.id">
            <i class="fa fa-times"></i></button>
        <button class="btn btn-default btn-round" title="Save"
                ng-click="edit.save()"
                ng-if="edit.model && !rtEdit.rt"
                form="editor">
            <i class="fa fa-check"></i></button>
        <button class="btn btn-default btn-round" title="Edit"
                ng-click="edit.edit()"
                ng-if="survey.isEditable && !edit.model &&
                    checkRole('survey_edit')">
            <i class="fa fa-pencil"></i></button>
        <survey-history entity="survey" service="Survey"
                ng-if="!edit.model"></survey-history>
    </div>
    <question-header entity="survey" type="survey"></question-header>
</div>
</div>

<div ng-if="edit.model" class="container">
    <form novalidate name="form" id="editor">
        <div class="form-group" show-errors>
            <label for="title">Name</label>
            <span class="help-label" ng-if="form.title.$error.required">
                Please provide a title.</span>
            <input type="text" class="form-control" id="title" name="title"
                ng-model="edit.model.title" required />
        </div>
        <div class="form-group">
            <label for="title">Description</label>
            <textarea type="text" class="autoresize form-control"
                id="desc" name="desc"
                ng-model="edit.model.description"></textarea>
        </div>
        <div ng-include="'response_types.html'"></div>
    </form>

    <ul class="fa-ul fa-ul-big text-muted">
        <li ng-if="!edit.model.id && duplicating">
            <i class="fa-li fa fa-clone fa-border"></i>
            <p>
                You are creating a duplicate of an existing program. The full
                structure of the program will be copied, with the lineage to the old
                program preserved. Submissions will not be copied, but they can
                be at a later time.
            </p>
            <p>
                If you want to create a fresh program with no lineage,
                <a href="#/surveys">go back</a> and use the Add
                <i class="fa fa-plus"></i> function instead.
            </p>
        </li>
        <li ng-if="!edit.model.id && !duplicating">
            <i class="fa-li fa fa-plus fa-border"></i>
            <p>
                You are creating a new program with a new structure. It will not
                be possible to link responses from other programs to this one.
            </p>
            <p>
                If you wish to preserve lineage, <a href="#/surveys">open an
                existing program</a> and use the Duplicate
                <i class="fa fa-clone"></i> function instead.
            </p>
        </li>
    </div>
</div>


<div ng-if="!edit.model">

<div class="container" ng-if="survey.description">
    <!-- Don't wrap the contents of this tag! -->
    <p class="formatted">{{survey.description}}</p>
</div>

<div class="container" ng-if="checkRole('survey_edit')">
    <p>
        <span ng-if="survey.isOpen && survey.isEditable">
            This program is open for submissions and is editable.
        </span>
        <span ng-if="!survey.isOpen && survey.isEditable">
            This program is not open for submissions but is editable.
        </span>
        <span ng-if="survey.isOpen && !survey.isEditable">
            This program is open for submissions but is not editable.
        </span>
    </p>
</div>

<div class="container" ng-if="!checkRole('survey_edit') && !survey.isOpen">
    <p>
        This program is not open for submissions. You can preview the program
        structure below.
    </p>
</div>


<div class="container" ng-if="checkRole('survey_state')">
    <p class="text-center">
        <!-- Admin buttons -->
        <button class="btn btn-link" ng-click="toggleOpen()">
            <span ng-if="survey.isOpen">
                <i class="fa fa-ban"></i>
                Un-open program</span>
            <span ng-if="!survey.isOpen">
                <i class="fa fa-circle-o"></i>
                Open program</span>
        </button>
        <button class="btn btn-link" ng-click="toggleEditable()">
            <i class="fa fa-pencil-square-o">
                <i ng-if="survey.isEditable"
                    class="fa fa-ban fa-badge fa-badge-left"></i>
            </i>
            <span ng-if="survey.isEditable">
                Make non-editable</span>
            <span ng-if="!survey.isEditable">
                Make editable</span>
        </button>
    </p>
</div>


<div class="container">
    <div class="section">
        <div class="toolbar">
            <a class="btn btn-default btn-round" title="Search for measures"
                    ng-href="#/measures?survey={{survey.id}}">
                <i class="fa fa-fw fa-search"></i></a>
            <a class="btn btn-default btn-round" title="Add new"
                    ng-href="#/hierarchy/new?survey={{survey.id}}"
                    ng-if="survey.isEditable && checkRole('hierarchy_add')">
                <i class="fa fa-fw fa-plus"></i></a>
        </div>
        <h2 label="Sv">
            Surveys
        </h2>
    </div>

    <ul class="list-results">
        <li ng-repeat="hierarchy in hierarchies">
            <a ng-href="#/hierarchy/{{hierarchy.id}}/choice?survey={{survey.id}}">
                <h4>{{hierarchy.title}}</h4>
                <p class="truncate">{{hierarchy.nMeasures}} measures</p>
            </a>
        </li>
    </ul>

    <p ng-if="!hierarchies.length">
        There are no surveys yet.
    </p>
</div>


</div><!-- !edit.model -->
