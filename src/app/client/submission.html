<div class="header"
    ng-class="{'deleted': structure.deletedItem}">
<div class="container">
    <div class="toolbar">

        <span uib-dropdown dropdown-append-to-body
                ng-if="!structure.deletedItem && !edit.model">
            <button class="btn btn-default btn-round"
                    title="Export" uib-dropdown-toggle>
                <i class="fa fa-cloud-download"></i></button>

            <ul uib-dropdown-menu class="dropdown-menu-right">
                <li class="dropdown-header">Export submission</li>
                <li>
                    <a title="Download Excel file"
                            ng-click="download('nested')"
                            download>
                        <i class="fa fa-th-list"></i>
                        Colourful spreadsheet
                    </a>
                </li>
                <li>
                    <a title="Download Excel file"
                            ng-click="download('tabular')"
                            download>
                        <i class="fa fa-list-ol"></i>
                        One measure per row
                    </a>
                </li>
            </ul>
        </span>

        <a class="btn btn-default btn-round" title="Statistics"
                ng-href="#/2/statistics?submission1={{submission.id}}"
                ng-if="!structure.deletedItem && !edit.model &&
                       checkRole('submission_admin')">
            <i class="fa fa-sml fa-bar-chart-o"></i></a>
        <button class="btn btn-default btn-round" title="Collapse"
                ng-click="layout.expandHeader = !layout.expandHeader">
            <i class="fa fa-angle-double-up" ng-if="layout.expandHeader"></i>
            <i class="fa fa-angle-double-down" ng-if="!layout.expandHeader"></i>
        </button>
        <button class="btn btn-default btn-round" title="Print"
                ng-if="!structure.deletedItem && !edit.model"
                onclick="print()">
            <i class="fa fa-print"></i>
        </button>

        <delete-button model="submission" editor="edit"
                ng-if="!edit.model && checkRole('submission_admin')"></delete-button>

        <button class="btn btn-default btn-round" title="Cancel"
                ng-click="edit.cancel()"
                ng-if="edit.model && edit.model.id">
            <i class="fa fa-times"></i></button>
        <a class="btn btn-default btn-round" title="Cancel"
                ng-href="#/2/program/{{program.id}}"
                ng-if="edit.model && !edit.model.id">
            <i class="fa fa-times"></i></a>
        <button class="btn btn-default btn-round" title="Save"
                ng-click="edit.save()"
                ng-if="edit.model"
                form="editor"
                form-save-button="editor">
            <i class="fa fa-check"></i></button>
        <button class="btn btn-default btn-round" title="Edit"
                ng-click="edit.edit()"
                ng-if="!structure.deletedItem && !edit.model &&
                       checkRole('submission_edit')">
            <i class="fa fa-pencil"></i></button>
        <a class="btn btn-default btn-round" title="Subscriptions"
                ng-href="#/2/subscription/submission?id={{submission.id}}"
                ng-if="!edit.model">
            <i class="fa fa-envelope"></i></a>
    </div>
    <question-header entity="submission.survey" submission="submission"></question-header>
</div>
</div>

<submission-header ng-if="!edit.model"></submission-header>

<div class="container" ng-if="edit.model && !edit.model.survey">
    <p>
        Please choose a survey. This will determine the categories that
        are available to you.
    </p>

    <ul class="list-results">
        <li ng-repeat="survey in surveys">
            <a href ng-click="edit.model.survey = survey">
                <h4>{{survey.title}}</h4>
                <p class="truncate">{{survey.nMeasures}} measures</p>
            </a>
        </li>
    </ul>
</div>

<div class="container" ng-if="edit.model && edit.model.survey">
    <form novalidate name="form" id="editor" form-nav-warn>
        <div class="form-group" show-errors>
            <label for="title">Name</label>
            <span class="help-label" ng-if="form.title.$error.required">
                Please provide a title.</span>
            <input type="text" class="form-control" id="title" name="title"
                ng-model="edit.model.title" required />
        </div>
        <div class="checkbox"
                ng-if="!edit.model.id && !duplicate && checkRole('program_edit')">
            <label>
                <input type="checkbox" id="fillRandom" name="fillRandom"
                    ng-model="edit.params.fillRandom" />
                Fill with random scores
            </label>
        </div>
    </form>

    <p class="text-muted" ng-if="duplicate">
        Source submission: <i>{{duplicate.title}}</i>
    </p>

    <p class="text-muted">
        Target survey: <i>{{edit.model.survey.title}}</i>
    </p>

</div>

<div ng-if="!edit.model" class="container">
    <!-- Don't wrap the contents of this tag! -->
    <p ng-if="submission.survey.description"
            class="formatted">Submission against {{submission.survey.description}}</p>

    <approval-buttons class="spaced" model="submission.approval"
            ng-if="!structure.deletedItem"
            set-state="setState(state)"></approval-buttons>
    <p ng-class="structure.deletedItem ? null : 'visible-print'">
        Status: {{submission.approval}}.
    </p>
    <docs>
        <i class="fa-li fa fa-chevron-right fa-border"></i>
        <h3>Approval</h3>
        <p>
            Submissions progress through approval
            states
            <em class="text-bar1">draft</em> &raquo;
            <em class="text-bar2">final</em> &raquo;
            <em class="text-bar3">reviewed</em> &raquo;
            <em class="text-bar4">approved</em>.
            A submission can only progress to the next state when all of its
            measures have at least that state. Measures can be promoted in bulk
            from the category screen; click on a category to move to that
            screen.
        </p>
    </docs>
</div>

<div class="container"
    ng-controller="QnodeChildren" ng-include="'qnode_children.html'"
    ng-if="!edit.model"></div>
