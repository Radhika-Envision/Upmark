<div>

<div class="header">
<div class="container">
    <div class="toolbar">
        <button class="btn btn-default btn-round" title="Delete"
                ng-click="edit.del()"
                ng-if="!edit.model && checkRole('org_del')">
            <i class="fa fa-trash-o"></i></button>
        <button class="btn btn-default btn-round" title="Cancel"
                ng-click="edit.cancel()"
                ng-if="edit.model && edit.model.id">
            <i class="fa fa-times"></i></button>
        <button class="btn btn-default btn-round" title="Save"
                ng-click="edit.save()"
                ng-if="edit.model"
                form="editor"
                form-save-button="editor">
            <i class="fa fa-check"></i></button>
        <button class="btn btn-default btn-round" title="Edit"
                ng-click="edit.edit()"
                ng-if="!edit.model && checkRole('org_modify')">
            <i class="fa fa-pencil"></i></button>
        <a class="btn btn-default btn-round" title="Subscriptions"
                ng-href="#/subscription/organisation?id={{org.id}}">
            <i class="fa fa-envelope"></i></a>
    </div>
    <h2 page-title>
        <i class="fa fa-fw fa-university"></i>
        <a href="#/orgs">Organisations</a> &raquo;
        <span ng-if="org.name">{{org.name}}</span>
        <span ng-if="!org.name">New organisation</span>
    </h2>
</div>
</div>

<div ng-if="edit.model">
<div class="container">
    <form novalidate name="form" id="editor" form-nav-warn>
        <div class="form-group" show-errors>
            <label for="org_name">Name</label>
            <span class="help-label" ng-if="form.org_name.$error.required">
                *</span>
            <input type="text" class="form-control"
                    id="org_name" name="org_name"
                    ng-model="edit.model.name" required />
        </div>
        <div class="form-group" show-errors>
            <label for="org_url">Web site</label>
            <span class="help-label" ng-if="form.org_url.$error.required">
                *</span>
            <input type="text" class="form-control"
                    id="org_url" name="org_url"
                    ng-model="edit.model.url" required />
        </div>
        <div class="form-group" show-errors>
            <label for="org_customers">Number of customers</label>
            <span class="help-label" ng-if="form.org_customers.$error.required">
                *</span>
            <span class="help-label" ng-if="form.org_customers.$error.min">
                Negative numbers are not allowed</span>
            <span class="help-label" ng-if="form.org_customers.$error.number">
                Must be a number</span>
            <input type="number" class="form-control"
                    id="org_customers" name="org_customers"
                    ng-model="edit.model.numberOfCustomers"
                    required min="0" />
        </div>

        <div class="section">
            <div class="toolbar">
                <a class="btn btn-default btn-round" title="Add location"
                        ng-click="edit.model.locations.push(null)">
                    <i class="fa fa-fw fa-plus"></i>
                </a>
            </div>
            <h2>
                Locations
            </h2>
        </div>
        <table class="table" ng-if="boxed_locations.length">
            <tr class="form-row" ng-repeat="loc in boxed_locations">
                <td>
                    <ui-select ng-model="loc.data" reset-search-input="false">
                        <ui-select-match placeholder="Type to select a location">
                            {{loc.data.description}}
                        </ui-select-match>
                        <ui-select-choices
                                repeat="l in locations"
                                refresh="searchLoc($select.search)"
                                refresh-delay="1000">
                            <div ng-bind-html="l.description |
                                               highlight: $select.search">
                            </div>
                        </ui-select-choices>
                    </ui-select>
                    <p class="text-muted commasep">
                        <span class="" ng-if="loc.data.country">
                            country:
                            {{loc.data.country}}</span><!--
                     --><span class="" ng-if="loc.data.state">
                            state:
                            {{loc.data.state}}</span><!--
                     --><span class="" ng-if="loc.data.region">
                            region/state district:
                            {{loc.data.region}}</span><!--
                     --><span class="" ng-if="loc.data.county">
                            county:
                            {{loc.data.county}}</span><!--
                     --><span class="" ng-if="loc.data.postcode">
                            postcode:
                            {{loc.data.postcode}}</span><!--
                     --><span class="" ng-if="loc.data.city">
                            city/town:
                            {{loc.data.city}}</span><!--
                     --><span class="" ng-if="loc.data.suburb">
                            suburb:
                            {{loc.data.suburb}}</span>
                    </p>
                </td>
                <td class="shrink">
                    <button class="btn btn-default btn-round"
                            title="Remove"
                            ng-click="deleteLocation(loc)">
                        <i class="fa fa-fw fa-trash-o"></i></button>
                </td>
            </tr>
        </table>
        <p ng-if="!boxed_locations.length">
            No locations have been selected. Press the
            <i class="fa fa-plus"></i> button to add one.
        </p>
    </form>
</div>
</div>

<div ng-if="!edit.model">
<div class="container">
    <dl>
        <dt ng-if="org.url">Web site</dt>
        <dd ng-if="org.url"><a ng-href="{{org.url}}">{{org.url}}</a></dd>

        <dt ng-if="org.numberOfCustomers">Number of customers</dt>
        <dd ng-if="org.numberOfCustomers">{{org.numberOfCustomers}}</dd>

        <dt ng-repeat-start="loc in org.locations">
            Location:
            {{loc.description}}
        </dt>
        <dd ng-repeat-end>
            <p class="text-muted commasep">
                <span class="" ng-if="loc.country">
                    country:
                    {{loc.country}}</span><!--
             --><span class="" ng-if="loc.state">
                    state:
                    {{loc.state}}</span><!--
             --><span class="" ng-if="loc.region">
                    region/state district:
                    {{loc.region}}</span><!--
             --><span class="" ng-if="loc.county">
                    county:
                    {{loc.county}}</span><!--
             --><span class="" ng-if="loc.postcode">
                    postcode:
                    {{loc.postcode}}</span><!--
             --><span class="" ng-if="loc.city">
                    city/town:
                    {{loc.city}}</span><!--
             --><span class="" ng-if="loc.suburb">
                    suburb:
                    {{loc.suburb}}</span>
            </p>
        </dd>
    </dl>
</div>
</div>


<div class="container" ng-controller="PurchasedSurveyCtrl"
        ng-if="!edit.model && checkRole('assessment_browse')">
    <div class="section">
        <div class="toolbar">
            <a class="btn btn-default btn-round" title="Add new"
                    ng-href="#/org/{{org.id}}/survey/add"
                    ng-if="checkRole('survey_purchase')">
                <i class="fa fa-fw fa-plus">
                    <i class="fa fa-badge fa-link"></i>
                </i></a>
        </div>
        <h2 label="Sv">
            Surveys
        </h2>
    </div>

    <ul class="list-results">
        <li ng-repeat="hierarchy in hierarchies">
            <a ng-href="#/hierarchy/{{hierarchy.id}}/choice?survey={{hierarchy.survey.id}}&organisation={{org.id}}">
                <h4>{{hierarchy.title}}</h4>
                <p class="truncate">In {{hierarchy.survey.title}} -
                    {{hierarchy.nMeasures}} measures</p>
            </a>
        </li>
    </ul>

    <p ng-if="!hierarchies.length">
        <i>{{org.name}}</i> is not participating in any surveys yet.
    </p>
</div>


<user-list class="nested" ng-if="!edit.model" org="org" hide-org></user-list>

<div class="container">
    <h4 class="section" ng-if="attributions.length">Location data copyright</h4>
    <p class="text-muted" ng-repeat="a in attributions">
        {{a.text}}
    </p>
</div>

</div>
