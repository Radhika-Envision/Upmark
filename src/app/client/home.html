<div class="header">
<div class="container">
    <div class="toolbar">
        <button class="btn btn-default btn-round"
                title="Previous"
                ng-click="previousActivities()">
            <i class="fa fa-caret-left"></i>
        </button>
        <button class="btn btn-default btn-round"
                title="Now"
                ng-click="goToNow()">
            <i class="fa fa-home"></i>
        </button>
        <button class="btn btn-default btn-round"
                title="Next"
                ng-click="nextActivities()">
            <i class="fa fa-caret-right"></i>
        </button>
        <button class="btn btn-default btn-round" title="Print"
                onclick="print()"
                ng-if="!showPost">
            <i class="fa fa-print"></i>
        </button>
        <button class="btn btn-default btn-round"
                title="{{showPost ?
                           'Cancel post' :
                           'Post a new message'}}"
                ng-click="togglePost()"
                ng-if="checkRole('post_message')">
            <i class="fa fa-envelope-o"
                ng-if="!showPost"></i>
            <i class="fa fa-times"
                ng-if="showPost"></i>
        </button>
        <button class="btn btn-default btn-round"
                title="Submit"
                ng-click="postMessage()"
                ng-if="showPost">
            <i class="fa fa-check"></i>
        </button>
    </div>
    <h2>
        Timeline -
        {{activityParams.period / secondsInADay}}
        days to {{activity.until * 1000 | date:'mediumDate'}}
    </h2>
</div>
</div>

<div class="container container-fluid" ng-if="!showPost"><div class="row">

<div class="col-sm-8">
    <ul class="list-results fa-ul fa-ul-big timeline">
        <li ng-repeat="action in activity.actions"
                ng-class="cls(action)">
            <i class="fa fa-li fa-border fa-border-fill"
                    ng-class="icons(action)[0]">
                <i class="fa fa-badge fa-plus"
                        ng-if="icons(action).length > 1"></i>
            </i>
            <div class="pull-right hidden-print hover-parent">
                <button class="btn btn-default btn-round"
                        title="Delete (usually you should just unpin)"
                        ng-click="remove(action)"
                        ng-if="checkRole('modify_post') &&
                               verbs(action) == 'broadcast'">
                    <i class="fa fa-fw fa-trash-o"></i>
                </button>
                <button class="btn btn-default btn-round"
                        title="Pin / Unpin"
                        ng-click="toggleSticky(action)"
                        ng-if="checkRole('modify_post')">
                    <i class="fa fa-fw fa-thumb-tack">
                        <i class="fa fa-badge fa-times"
                                ng-if="action.sticky"></i>
                    </i>
                </button>
                <a class="btn btn-default btn-round"
                        title="View {{action.subject.name}}'s profile"
                        ng-href="#/user/{{action.subject.id}}">
                    <i class="fa fa-fw fa-user"></i>
                </a>
            </div>
            <a ng-href="#{{url(action)}}"
                    title="View this {{obType(action)}}"
                    ng-if="verbs(action) != 'broadcast'">
                {{action.subject.name}}
                <span class="text-muted">
                    {{verbs(action)}} the {{obType(action)}}
                </span>
                {{action.message}}
                <p class="text-muted">
                    {{action.created * 1000 | timeAgo:'medium'}}
                    <i class="fa fa-thumb-tack" ng-if="action.sticky"
                        title="Pinned"></i>
                </p>
            </a>
            <div ng-if="verbs(action) == 'broadcast'">
                {{action.subject.name}}<span class="text-muted"> said:</span>
                <p>{{action.message}}</p>
                <p class="text-muted">
                    {{action.created * 1000 | timeAgo:'medium'}}
                    <i class="fa fa-thumb-tack" ng-if="action.sticky"
                        title="Pinned"></i>
                </p>
            </div>
        </li>
        <li ng-if="!activity.actions.length">
            <i class="fa fa-li fa-border fa-border-fill fa-moon-o"></i>
            <a href="#/surveys" title="Browse programs">
                There are no events for this time period.
                <p class="hidden-print">
                    Perhaps you'd like to browse the programs?
                </p>
            </a>
        </li>
    </ul>
    <p class="text-muted">
        You can post to other people's timelines by pressing the <i class="fa fa-envelope-o"></i> button.
    </p>

</div> <!-- Timeline -->

<div class="col-sm-4 hidden-print">
    <ul class="cardlist list-results">
        <li ng-repeat="c in cards"
                ng-class="cls(c)">
            <a ng-href="#{{url(c)}}"
                    title="View this {{c.obType}}">
                <h4>{{c.title}}</h4>
                <p class="truncate">
                    <span class="capitalize">{{c.obType}}</span> -
                    {{c.created * 1000 | timeAgo:'mediumDate'}}
                </p>
            </a>
        </li>
        <li ng-if="!cards.length" class="text-muted">
            No cards to display.
        </li>
    </ul>
</div>

</div> <!-- row -->
</div> <!-- container-fluid -->


<div class="container" ng-if="showPost">
    <form novalidate name="form" id="post" class="hidden-print">
        <h3>Broadcast Message</h3>
        <div class="form-group">
            <label for="message" class="sr-only">Message</label>
            <textarea class="autoresize form-control"
                id="message" name="message"
                ng-model="post.message"></textarea>
        </div>
        <div class="text-center">
            <div class="form-group" ng-if="checkRole('post_to_all')">
                <div class="btn-group">
                    <span class="btn-group-addon">
                        To:
                    </span>
                    <button class="btn btn-default"
                            ng-class="{'active': post.to == 'all'}"
                            ng-click="post.to = 'all'"
                            title="Post to all users">
                        Everyone
                    </button>
                    <button class="btn btn-default"
                            ng-class="{'active': post.to == 'org'}"
                            ng-click="post.to = 'org'"
                            title="Post only to users in my organisation">
                        My Organisation
                    </button>
                </div>
                <button class="btn btn-default"
                        ng-class="{'active': post.sticky}"
                        ng-click="post.sticky = !post.sticky"
                        title="Keep post at top">
                    <i class="fa fa-thumb-tack"></i>
                    Pin
                </button>
            </div>
        </div>
    </form>

    <docs>
        <i class="fa-li fa fa-envelope-o fa-border"></i>
        You can post messages to the timeline.
        <span ng-if="checkRole('post_to_all')">
            You can choose to make your message visible to all users, or only
            users in your organisation.
        </span>
        <span ng-if="!checkRole('post_to_all')">
            Your post will only be visible to members of your organisation.
        </span>
        <p>
            Pinned messages <i class="fa fa-thumb-tack"></i> will stay at the
            top of the timeline until you unpin them. An unpinned message will
            be moved to the time at which it was created.
            Generally it is preferred to unpin messages instead of deleting
            them.
        </p>
    </docs>
</div>
