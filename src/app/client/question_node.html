<div>

<div class="header">
<div class="container">
    <div class="toolbar">
        <button class="btn btn-default btn-round" title="Delete"
                ng-click="edit.del()"
                ng-if="survey.isEditable && !edit.model &&
                    checkRole('qnode_del')">
            <i class="fa fa-trash-o"></i></button>
        <button class="btn btn-default btn-round" title="Collapse"
                ng-click="layout.expandHeader = !layout.expandHeader">
            <i class="fa fa-angle-double-up" ng-if="layout.expandHeader"></i>
            <i class="fa fa-angle-double-down" ng-if="!layout.expandHeader"></i>
        </button>
        <button class="btn btn-default btn-round" title="Cancel"
                ng-click="edit.cancel()"
                ng-if="edit.model && edit.model.id">
            <i class="fa fa-times"></i></button>
        <button class="btn btn-default btn-round" title="Save"
                ng-click="edit.save()"
                ng-if="edit.model"
                form="editor">
            <i class="fa fa-check"></i></button>
        <button class="btn btn-default btn-round" title="Edit"
                ng-click="edit.edit()"
                ng-if="survey.isEditable && !edit.model &&
                    checkRole('qnode_edit')">
            <i class="fa fa-pencil"></i></button>
        <survey-history entity="qnode" service="QuestionNode"
                ng-if="!edit.model"></survey-history>
    </div>
    <question-header entity="qnode" assessment="assessment"></question-header>
</div>
</div>

<div ng-if="edit.model">
<div class="container">
    <form novalidate name="form" id="editor">
        <div class="form-group" show-errors>
            <label for="title">Name</label>
            <span class="help-label" ng-if="form.title.$error.required">
                Please provide a title.</span>
            <input type="text" class="form-control" id="title" name="title"
                ng-model="edit.model.title" required />
        </div>
        <div class="form-group" show-errors>
            <label for="desc">Description</label>
            <textarea id="desc" name="desc" class="autoresize form-control"
                ng-model="edit.model.description"></textarea>
        </div>
    </form>
</div>
</div>

<div ng-if="!edit.model && qnode.description">
<div class="container">
    <p class="formatted">{{qnode.description}}</p>
</div>
</div>

<script type="text/ng-template" id="qnode-reorder.html">
    <table class="table table-hover">
        <tbody ui-sortable="dragOpts" ng-model="model">
            <tr ng-repeat="item in model" any-href="{{itemUrl(item, $index)}}">
                <td class="shrink">{{item.seq + 1}}</td>
                <td>{{item.title}}</td>
                <td class="shrink text-muted">{{item.nMeasures}}</td>
                <td class="shrink grab-handle">
                    <i class="fa fa-fw fa-unsorted"></i></td>
            </tr>
        </tbody>
    </table>
</script>

<script type="text/ng-template" id="measure-reorder.html">
    <table class="table table-hover">
        <tbody ui-sortable="dragOpts" ng-model="model">
            <tr ng-repeat="item in model" any-href="{{itemUrl(item, $index)}}">
                <td class="shrink">{{item.seq + 1}}</td>
                <td>{{item.title}}</td>
                <td class="shrink text-muted">{{item.approval}}</td>
                <td class="shrink grab-handle">
                    <i class="fa fa-fw fa-unsorted"></i></td>
            </tr>
        </tbody>
    </table>
</script>

<reorderable item-url="qnodeUrl"
        model="children" check-role="checkRole"
        title="{{nextLevel.title}}"
        params="{surveyId: survey.id, parentId: qnode.id}"
        resource="QuestionNode" scores="responseNodeMap"
        ng-if="nextLevel && !edit.model"
        can-edit="survey.isEditable && !assessment"
        template-url="qnode-reorder.html"></reorderable>

<reorderable item-url="measureUrl"
        model="measures" check-role="checkRole"
        title="{{structure.hierarchy.structure.measure.title}}"
        params="{surveyId: survey.id, qnodeId: qnode.id}"
        resource="Measure" scores="responseMap"
        ng-if="currentLevel.hasMeasures && !edit.model"
        can-edit="survey.isEditable"
        template-url="measure-reorder.html">
    <a class="btn btn-default btn-round" title="Link to existing"
            ng-href="#/measure-link?survey={{survey.id}}&parent={{qnode.id}}"
            ng-if="survey.isEditable && !edit.model && checkRole('add') && !assessment">
        <i class="fa fa-fw fa-link"></i></a>
</reorderable>

</div>
