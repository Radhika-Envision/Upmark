<div class="header"
    ng-class="{'deleted': structure.deletedItem}">
<div class="container">
    <div class="toolbar">
        <button class="btn btn-default btn-round"
                title="Unlink from parent"
                ng-click="edit.del()"
                ng-if="structure.survey && editable && !edit.model && checkRole('measure_del')">
            <i class="fa fa-trash-o"></i>
        </button>
        <button class="btn btn-default btn-round" title="Collapse"
                ng-click="layout.expandHeader = !layout.expandHeader">
            <i class="fa fa-angle-double-up" ng-if="layout.expandHeader"></i>
            <i class="fa fa-angle-double-down" ng-if="!layout.expandHeader"></i>
        </button>
        <button class="btn btn-default btn-round" title="Print"
                ng-if="!edit.model"
                onclick="print()">
            <i class="fa fa-print"></i>
        </button>
        <button class="btn btn-default btn-round" title="Cancel"
                ng-click="edit.cancel()"
                ng-if="edit.model && edit.model.id">
            <i class="fa fa-times"></i></button>
        <button class="btn btn-default btn-round" title="Save"
                ng-click="save()"
                ng-if="edit.model"
                form="editor"
                form-save-button="editor">
            <i class="fa fa-check"></i></button>
        <button class="btn btn-default btn-round" title="Edit"
                ng-click="edit.edit()"
                ng-if="editable && !edit.model">
            <i class="fa fa-pencil"></i></button>
        <a class="btn btn-default btn-round" title="Subscriptions"
                ng-href="#/2/subscription/measure?id={{measure.id}}&id={{program.id}}"
                ng-if="!edit.model && !submission">
            <i class="fa fa-envelope"></i></a>
        <a class="btn btn-default btn-round" title="Subscriptions"
                ng-href="#/2/subscription/response?id={{measure.id}}&id={{submission.id}}"
                ng-if="!edit.model && submission">
            <i class="fa fa-envelope"></i></a>
        <program-history entity="measure" service="Measure"
                ng-if="!submission && !edit.model"></program-history>
    </div>
    <question-header entity="measure" submission="submission"></question-header>
</div>
</div>

<submission-header></submission-header>
<div ng-if="!structure.survey" class="subheader bg-warning">
    <div class="container">
        <p>
            You are viewing this measure outside the scope of any survey.
            <span ng-if="measure.parents.length">
                Please choose a survey:
            </span>
            <span ng-if="!measure.parents.length">
                This measure is an orphan: it belongs to no categories.
            </span>
        </p>
        <ul ng-if="measure.parents.length">
            <li ng-repeat="parent in measure.parents">
                <a ng-href="#/2/measure/{{measure.id}}?program={{structure.program.id}}&survey={{parent.survey.id}}">
                    <span ng-class="{strike: parent.survey.deleted}">
                        {{parent.survey.title}}
                    </span>
                </a>
            </li>
        </ul>
    </div>
</div>
<div error-header structure-node="measure" submission-node="response"
    ng-if="!edit.model"></div>

<div ng-if="edit.model" class="container" ng-include="'measure_edit.html'">
</div>

<docs ng-if="structure.deletedItem">
    <i class="fa-li fa fa-trash fa-border"></i>
    <h3>Deleted</h3>
    <p>
        This measure, or one of its parents, has been deleted. It is still
        accessible for archival reasons, but it will not be included in
        survey score calculations.
    </p>
</docs>

<script type="text/ng-template" id="/inline/measure_variable_list.html">
    <h3 ng-if="measure.sourceVars.length || measure.targetVars.length">Links to Other Measures</h3>
    <div ng-if="measure.sourceVars.length">
        <p class="text-muted">
            This measure gets some data from these other measures:
        </p>
        <ul class="list-unstyled">
            <li ng-repeat="mv in measure.sourceVars">
                <em>
                    This measure • {{mv.targetField}} ←
                </em>
                <a ng-href="#{{getUrl(mv.sourceMeasure)}}"}}>
                    <em>{{mv.sourceMeasure.title}}</em
                    ><em> • {{mv.sourceField}}</em>
                </a>
            </li>
        </ul>
    </div>
    <div ng-if="measure.targetVars.length">
        <p class="text-muted">
            These other measures use data from this measure:
        </p>
        <ul class="list-unstyled">
            <li ng-repeat="mv in measure.targetVars">
                <em>
                    This measure • {{mv.sourceField}} →
                </em>
                <a ng-href="#{{getUrl(mv.targetMeasure)}}"}}>
                    <em>{{mv.targetMeasure.title}}</em
                    ><em> • {{mv.targetField}}</em>
                </a>
            </li>
        </ul>
    </div>
</script>

<div ng-if="!edit.model" class="container">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6">
                <h2>Description</h2>
                <div ng-bind-html="measure.description | markdown"></div>
                <p class="text-muted" ng-if="!measure.description">
                    No description.
                </p>
            </div>

            <div class="col-md-6" ng-if="!submission">
                <h2>Response</h2>
                <p class="text-muted">
                    The response form will be displayed here when filling out a
                    submission.
                </p>

                <div ng-include src="'/inline/measure_variable_list.html'"></div>
            </div>

            <div class="col-md-6" ng-if="submission"
                    ng-include="'measure_response.html'">
            </div>

        </div>
    </div>
</div>

<docs ng-if="!structure.submission && !edit.model && parents && checkRole('measure_edit')">
    <i class="fa-li fa fa-sitemap fa-border"></i>
    <h3>Hierarchy</h3>
    A program's measures can be shared between its surveys.
    <span ng-if="measure.parents.length">
        <!-- Only show this if the measure is being shown as part of a survey,
             because otherwise the surveys will be listed in the body of the
             page above. -->
        This measure is available in the following surveys:
    </span>
    <ul ng-if="measure.parents.length">
        <li ng-repeat="parent in measure.parents">
            <a ng-href="#/2/measure/{{measure.id}}?program={{structure.program.id}}&survey={{parent.survey.id}}">
                <span ng-class="{strike: parent.survey.deleted}">
                    {{parent.survey.title}}
                </span>
            </a>
        </li>
    </ul>
    This measure can be
    <a ng-href="#/2/measure/{{measure.id}}?program={{program.id}}">
        viewed without a survey</a>,
    but it can not be responded to like that.
</docs>
